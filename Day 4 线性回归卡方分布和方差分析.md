### 卡方分布

卡方分布 ($χ^2​$分布)是概率论与统计学中常用的一种概率分布。$k​$ 个独立的标准正态分布变量的平方和服从自由度为$k​$ 的卡方分布。卡方分布常用于假设检验和置信区间的计算。

### 卡方分布的数学定义

　　若$k$ 个随机变量$Z1、……、Zk$ 相互独立，且数学期望为0、方差为 1(即服从标准正态分布)，则随机变量$X$
$$
X=\sum_{n=1}^{k} Z_{n}^{2}
$$
被称为服从自由度为k的卡方分布，记作:
$$
X \sim \chi^{2}(k)
$$


### 卡方的分布特征

卡方分布的概率密度函数为：
$$
f_{k}(x)=\frac{(1 / 2)^{k / 2}}{\Gamma(k / 2)} x^{k / 2-1} e^{-x / 2}
$$
其中x≥0, 当x≤0时fk(x) = 0。这里Γ代表Gamma 函数。

![300px-概率密度函数](/Users/laozhaotou/Desktop/300px-概率密度函数.png)

卡方分布的累积分布函数为：
$$
F_{k}(x)=\frac{\gamma(k / 2, x / 2)}{\Gamma(k / 2)}
$$
其中γ(k,z)为不完全Gamma函数。

![300px-累积分布函数2](/Users/laozhaotou/Desktop/300px-累积分布函数2.png)

卡方分布可以用来测试随机变量之间是否相互独立，也可以用来检测统计模型是否符合实际要求。

自由度为k的卡方变量的平均值为k，方差是2k。卡方分布是伽马分布的一个特例，他的熵为：
$$
H=\int_{-\infty}^{\infty} f(x) \ln (f(x)) d x=\frac{k}{2}+\ln \left(2 \Gamma\left(\frac{k}{2}\right)\right)+\left(1-\frac{k}{2}\right) \psi(k / 2)
$$
其中$ψ(x)$ 是 Digamma function。



### 卡方变数与Gamma变数的关系

当Gamma变数频率(λ)为1/2 时，α 的2倍为卡方变数之自由度(Degree of freedom)

即：
$$
r . v . Y=\chi^{2}(U)=\Gamma\left(\frac{U}{2}, \frac{1}{2}\right)
$$

$$
E\left(\chi^{2}(U)\right)=E(Y)=\frac{\alpha}{\lambda}=\frac{\frac{U}{2}}{\frac{1}{2}}=U
$$

$$
\operatorname{Var}\left(\chi^{2}(U)\right)=\operatorname{Var}(Y)=\frac{\alpha}{\lambda^{2}}=\frac{\frac{U}{2}}{\left(\frac{1}{2}\right)^{2}}=2 U
$$

卡方变数之期望值=自由度卡方变数之方差=两倍自由度

卡方分布

| 参数              | k>0,自由度                                                   |      |
| ----------------- | ------------------------------------------------------------ | ---- |
| 值域              | $x \in[0 ;+\infty)$                                          |      |
| 概率密度函数      | $\frac{(1 / 2)^{k / 2}}{\Gamma(k / 2)} x^{k / 2-1} e^{-x / 2}$ |      |
| 概率分布函数(CDF) | $\frac{\gamma(k / 2, x / 2)}{\Gamma(k / 2)}<br/>$            |      |
| 期望值            | k                                                            |      |
| 中位数            | 大约$(k-2)/3$                                                |      |
| 众数              | k-2, if $k\geq3$                                             |      |
| 方差              | 2,k                                                          |      |
| 偏态              | $\sqrt{8/k}$                                                 |      |
| 峰态              | 12/k                                                         |      |
| 熵值              | $\frac{k}{2}+\ln (2 \Gamma(k / 2))+(1-k / 2) \psi(k / 2)
$    |      |
| 动差生成函数(mgf) | $(1-2 t)^{-k / 2}, 2 t<1$                                    |      |
| 特征函数          | $(1-2 it)^{-k / 2}$                                          |      |

### 卡方检验

　　**卡方检验**是一种用途很广的计数资料的[假设检验](https://wiki.mbalib.com/wiki/%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C)方法。它属于[非参数检验](https://wiki.mbalib.com/wiki/%E9%9D%9E%E5%8F%82%E6%95%B0%E6%A3%80%E9%AA%8C)的范畴，主要是比较两个及两个以上样本率( 构成比）以及两个[分类变量](https://wiki.mbalib.com/wiki/%E5%88%86%E7%B1%BB%E5%8F%98%E9%87%8F)的关联性分析。其根本思想就是在于比较理论频数和实际频数的吻合程度或拟合优度问题。

　　它在分类资料[统计推断](https://wiki.mbalib.com/wiki/%E7%BB%9F%E8%AE%A1%E6%8E%A8%E6%96%AD)中的应用，包括：两个率或两个构成比比较的卡方检验；多个率或多个构成比比较的卡方检验以及分类资料的[相关分析](https://wiki.mbalib.com/wiki/%E7%9B%B8%E5%85%B3%E5%88%86%E6%9E%90)等。

### 卡方检验的基本思想

　　卡方检验是以$χ^2$分布为基础的一种常用假设检验方法，它的无效假设$H_0$是：观察频数与期望频数没有差别。

　　该检验的基本思想是：首先假设$H_0$成立，基于此前提计算出$χ^2$值，它表示观察值与理论值之间的偏离程度。根据$χ^2$分布及自由度可以确定在$H_0$假设成立的情况下获得当前统计量及更极端情况的概率$P$。如果$P​$值很小，说明观察值与理论值偏离程度太大，应当拒绝无效假设，表示比较资料之间有显著差异；否则就不能拒绝无效假设，尚不能认为样本所代表的实际情况和理论假设有差别。



### 卡方值的计算与意义

　　$χ^2$值表示观察值与理论值之问的偏离程度。计算这种偏离程度的基本思路如下。

　　(1)设A代表某个类别的观察频数，E代表基于$H_0​$计算出的期望频数，A与E之差称为残差。

　　(2)显然，残差可以表示某一个类别观察值和理论值的偏离程度，但如果将残差简单相加以表示各类别观察频数与期望频数的差别，则有一定的不足之处。因为残差有正有负，相加后会彼此[抵消](https://wiki.mbalib.com/wiki/%E6%8A%B5%E6%B6%88)，总和仍然为0，为此可以将残差平方后求和。

　　(3)另一方面，残差大小是一个相对的概念，相对于期望频数为10时，期望频数为20的残差非常大，但相对于期望频数为1 000时20的残差就很小了。考虑到这一点，人们又将残差平方除以期望频数再求和，以估计观察频数与期望频数的差别。

　　进行上述操作之后，就得到了常用的$χ^2$统计量，由于它最初是由英国统计学家Karl Pearson在1900年首次提出的，因此也称之为Pearson $χ^2$，其计算公式为:
$$
\chi^{2}=\sum \frac{(A-E)^{2}}{E}=\sum_{i=1}^{k} \frac{\left(A_{i}-E_{i}\right)^{2}}{E_{i}}=\sum_{i=1}^{k} \frac{\left(A_{i}-n p_{i}\right)^{2}}{n p_{i}} \quad(\mathrm{i}=1,2,3, \ldots, \mathrm{k})
$$


其中，$Ai$为$i$水平的观察频数，$E_i$为$i$水平的期望频数，$n$为总频数，$p_i$为$i$水平的期望频率。$i$水平的期望频数$E_i$等于总频数$n×i$水平的期望概率$p_i$，$k$为单元格数。当$n$比较大时，$χ^2$统计量近似服从$k-1$(计算$E_i$时用到的参数个数)个自由度的[卡方分布](https://wiki.mbalib.com/wiki/%E5%8D%A1%E6%96%B9%E5%88%86%E5%B8%83)。

　　作为学术界的领袖，Pearson先生当初发表在《哲学杂志》上的χ2论文题目为：On the criterion that a given system of deviations from the probable in the case of a correlated system of variables is such that it can be reasonably supposed to have arisen from random sampling.

　　由卡方的计算公式可知，当观察频数与期望频数完全一致时，$χ^2$值为0；观察频数与期望频数越接近，两者之间的差异越小，$χ^2$值越小；反之，观察频数与期望频数差别越大，两者之间的差异越大，$χ^2$值越大。换言之，大的$χ^2$值表明观察频数远离期望频数，即表明远离假设。小的$χ^2$值表明观察频数接近期望频数，接近假设。因此，$χ^2$是观察频数与期望频数之间距离的一种度量指标，也是假设成立与否的度量指标。如果$χ^2$值“小”，研究者就倾向于不拒绝$H_0$；如果$χ^2$值大，就倾向于拒绝 ​$H_0$。至于​$χ^2$在每个具体研究中究竟要大到什么程度才能拒绝 ​$H_0$，则要借助于卡方分布求出所对应的​$P$值来确定。

### 卡方检验的样本量要求

　　卡方分布本身是连续型分布，但是在分类资料的统计分析中，显然频数只能以整数形式出现，因此计算出的统计量是非连续的。只有当样本量比较充足时，才可以忽略两者问的差异，否则将可能导致较大的偏差具体而言，一般认为对于卡方检验中的每一个单元格，要求其最小期望频数均大于1，且至少有4／5的单元格期望频数大于5，此时使用卡方分布计算出的概率值才是准确的。如果数据不符合要求，可以采用确切概率法进行概率的计算。

### 卡方检验的类型

1. 四格表资料的卡方检验

四格表资料的卡方检验用于进行两个率或两个构成比的比较。

a. 专用公式：

　若四格表资料四个格子的[频数](https://wiki.mbalib.com/wiki/%E9%A2%91%E6%95%B0)分别为a，b，c，d，则，

四格表资料卡方检验的卡方值 $=(a d-b c) 2 \times n /(a+b)(c+d)(a+c)(b+d)$,自由度v=(行数-1)(列数-1)

b. 应用条件：

要求样本含量应大于40且每个格子中的理论频数不应小于5。当样本含量大于40但理论频数有小于5的情况时卡方值需要校正，当样本含量小于40时只能用确切概率法计算概率。

2. **行×列表资料的卡方检验**

   行×列表资料的卡方检验用于多个率或多个构成比的比较。

a. 专用公式：

r行c列表资料卡方检验的卡方值=$n\left[\left(A_{11} / n_{1} n_{1}+A_{12} / n_{1} n_{2}+\cdots+A_{r c} / n_{r} n_{c}\right)-1\right]​$

b. 应用条件：

要求每个格子中的理论频数$T$均大于5或$1<T<5$的格子数不超过总格子数的1/5。当有T<1或1<T<5的格子较多时，可采用并行并列、删行删列、增大样本含量的办法使其符合行×列表资料卡方检验的应用条件。而多个率的两两比较可采用行×列表分割的办法。

3. **列联表资料的卡方检验**

   同一组对象，观察每一个个体对两种分类方法的表现，结果构成双向交叉排列的[统计表](https://wiki.mbalib.com/wiki/%E7%BB%9F%E8%AE%A1%E8%A1%A8)就是列联表。

a. R*C R×C 列联表的卡方检验：

　　R×C 列联表的卡方检验用于R×C列联表的相关分析，卡方值的计算和检验过程与行×列表资料的卡方检验相同。

b. 2×2列联表的卡方检验：

　　2×2列联表的卡方检验又称配对记数资料或配对四格表资料的卡方检验，根据卡方值计算公式的不同，可以达到不同的目的。当用一般四格表的卡方检验计算时，卡方值$=(ad-bc)2n/(a+b)(c+d)(a+c)(b+d)$，此时用于进行配对四格表的相关分析，如考察两种检验方法的结果有无关系；当卡方值$=( | b − c| − 1)2/(b+c)$时，此时卡方检验用来进行四格表的差异检验，如考察两种检验方法的检出率有无差别。

　　列联表卡方检验应用中的注意事项同$R×C$表的卡方检验相同。

### 卡方检验的用途

卡方检验最常见的用途就是考察某无序分类变量各水平在两组或多组间的分布是否一致实际上，除了这个用途之外．卡方检验还有更广泛的应用。具体而言，其用途主要包括以下几个方面：

　　(1)检验某个连续变量的分布是否与某种理论分布相一致。如是否符合正态分布、是否服从均匀分布、是否服从Poisson分布等。

　　(2)检验某个分类变量各类的出现概率是否等于指定概率。如在36选7的彩票抽奖中，每个数字出现的概率是否各为1／36；掷硬币时，正反两面出现的概率是否均为0．5。

　　(3)检验某两个分类变量是否相互独立。如吸烟(二分类变量：是、否)是否与呼吸道疾病(二分类变量：是、否)有关；产品原料种类(多分类变量)是否与产品合格(二分类变量)有关。

　　(4)检验控制某种或某几种分类因素的作用以后，另两个分类变量是否相互独立。如在上例中，控制性别、年龄因素影响以后，吸烟是否和呼吸道疾病有关；控制产品加工工艺的影响后，产品原料类别是否与产品合格有关。

　　(5)检验某两种方法的结果是否一致。如采用两种诊断方法对同一批人进行诊断，其诊断结果是否一致；采用两种方法对客户进行价值类别预测，预测结果是否一致。

### 卡方检验的应用条件

适用于四格表应用条件：

　　1)随机样本数据。两个独立样本比较可以分以下3种情况：

　　(1)所有的理论数T≥5并且总样本量n≥40，用Pearson卡方进行检验。

　　(2)如果理论数T＜5但T≥1，并且1≥40，用连续性校正的卡方进行检验。

　　(3)如果有理论数T＜1或n＜40，则用Fisher’s检验。

　　2)卡方检验的理论频数不能太小。

　　R×C表卡方检验应用条件：

　　(1)R×C表中理论数小于5的格子不能超过1／5；

　　(2)不能有小于1的理论数。如果实验中有不符合R×C表的卡方检验，可以通过增加样本数、列合并来实现。

### 方差分析(Analysis of Variance, aka ANOVA)

　　**方差分析**（ANOVA）又称“**变异数分析**”或“**F检验**”，是[R.A.Fister](https://wiki.mbalib.com/wiki/R.A.Fister)发明的，用于两个及两个以上样本均数差别的[显著性检验](https://wiki.mbalib.com/wiki/%E6%98%BE%E8%91%97%E6%80%A7%E6%A3%80%E9%AA%8C)。

　　由于各种因素的影响，研究所得的数据呈现波动状。造成波动的原因可分成两类，一是不可控的随机因素，另一是研究中施加的对结果形成影响的可控因素。

　　一个复杂的事物，其中往往有许多因素互相制约又互相依存。**方差分析的目的是通过数据分析找出对该事物有显著影响的因素，各因素之间的交互作用，以及显著影响因素的最佳水平等。**方差分析是在可比较的数组中，把数据间的总的“变差”按各指定的变差来源进行分解的一种技术。对变差的度量，采用离差平方和。方差分析方法就是从总离差平方和分解出可追溯到指定来源的部分离差平方和，这是一个很重要的思想。

　　经过方差分析若拒绝了检验假设，只能说明多个样本总体均数不相等或不全相等。若要得到各组均数间更详细的信息，应在方差分析的基础上进行多个样本均数的两两比较。

　　**1、多个样本均数间两两比较**

多个样本均数间两两比较常用q检验的方法，即Newman-kueuls法，其基本步骤为：建立检验假设-->样本均数排序-->计算q值-->查q界值表判断结果。

　　**2、多个实验组与一个对照组均数间两两比较**

　　多个实验组与一个对照组均数间两两比较，若目的是减小第II类错误，最好选用最小显著差法（LSD法）；若目的是减小第I类错误，最好选用新复极差法，前者查t界值表，后者查q'界值表。

### 方差分析的基本思想

　　**基本思想：**通过分析研究中不同来源的变异对总变异的贡献大小，从而确定可控因素对研究结果影响力的大小。

如某克山病区测得11例克山病患者和13名健康人的血磷值（mmol/L）如下：

- 患者：0.84 1.05 1.20 1.20 1.39 1.53 1.67 1.80 1.87 2.07 2.11
- 健康人：0.54 0.64 0.64 0.75 0.76 0.81 1.16 1.20 1.34 1.35 1.48 1.56 1.87

　　问该地克山病患者与健康人的血磷值是否不同？

　　从以上资料可以看出，24个患者与健康人的血磷值各不相同，如果用离均差平方和（SS）描述其围绕总均数的变异情况，则总变异有以下两个来源：

- 组内变异，即由于[随机误差](https://wiki.mbalib.com/wiki/%E9%9A%8F%E6%9C%BA%E8%AF%AF%E5%B7%AE)的原因使得各组内部的血磷值各不相等；
- 组间变异，即由于克山病的影响使得患者与健康人组的血磷值均数大小不等。

　　而且：SS总=SS组间+SS组内 v总=v组间+v组内

　　如果用均方（即自由度v去除离均差平方和的商）代替离均差平方和以消除各组样本数不同的影响，则方差分析就是用组内均方去除组间均方的商（即F值）与1相比较，若F值接近1，则说明各组均数间的差异没有[统计学](https://wiki.mbalib.com/wiki/%E7%BB%9F%E8%AE%A1%E5%AD%A6)意义，若F值远大于1，则说明各组均数间的差异有统计学意义。实际应用中检验假设成立条件下F值大于特定值的概率可通过查阅F界值表（方差分析用）获得。

### 方差分析的应用条件

　　应用方差分析对资料进行[统计推断](https://wiki.mbalib.com/wiki/%E7%BB%9F%E8%AE%A1%E6%8E%A8%E6%96%AD)之前应注意其使用条件，包括：

　　1、可比性。若资料中各组均数本身不具可比性则不适用方差分析。

　　2、正态性。即[偏态分布](https://wiki.mbalib.com/wiki/%E5%81%8F%E6%80%81%E5%88%86%E5%B8%83)资料不适用方差分析。对偏态分布的资料应考虑用对数变换、平方根变换、倒数变换、平方根反正弦变换等变量变换方法变为正态或接近正态后再进行方差分析。

　　3、方差齐性。即若组间方差不齐则不适用方差分析。多个方差的齐性检验可用Bartlett法，它用卡方值作为检验[统计量](https://wiki.mbalib.com/wiki/%E7%BB%9F%E8%AE%A1%E9%87%8F)，结果判断需查阅卡方界值表。

　　方差分析主要用于：

　　1、均数差别的[显著性检验](https://wiki.mbalib.com/wiki/%E6%98%BE%E8%91%97%E6%80%A7%E6%A3%80%E9%AA%8C)；

　　2、分离各有关因素并估计其对总变异的作用；

　　3、分析因素间的交互作用；

　　4、方差齐性检验。

### 方差分析的主要内容

　　根据资料设计类型的不同，有以下两种方差分析的方法：

　　1、对成组设计的多个样本均数比较，应采用完全随机设计的方差分析，即[单因素方差分析](https://wiki.mbalib.com/wiki/%E5%8D%95%E5%9B%A0%E7%B4%A0%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90)。

　　2、对随机区组设计的多个样本均数比较，应采用配伍组设计的方差分析，即[两因素方差分析](https://wiki.mbalib.com/wiki/%E4%B8%A4%E5%9B%A0%E7%B4%A0%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90)。

　　两类方差分析的基本步骤相同，只是变异的分解方式不同，对成组设计的资料，总变异分解为组内变异和组间变异（随机误差），即：SS总=SS组间+SS组内，而对配伍组设计的资料，总变异除了分解为处理组变异和随机误差外还包括配伍组变异，即：SS总=SS处理+SS配伍+SS误差。整个方差分析的基本步骤如下：

　　1、建立检验假设；

- H0：多个样本总体均数相等；
- H1：多个样本总体均数不相等或不全等。

　　检验水准为0.05。

　　2、计算检验统计量F值；

　　3、确定P值并作出推断结果。